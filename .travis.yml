language: bash

matrix:
  include:
  - os: linux
    services: docker
    dist: trusty
    before_install:
    - docker build -t bubblesub .
    script:
    - docker run -ti bubblesub
  - os: windows
    services: docker
    before_deploy:
    - travis_wait 50 docker build -t bubblesub -f build/windows/Dockerfile .
    - build/windows/deploy-binary.bat
    deploy:
      provider: releases
      api_key:
        secure: WtfE32HAOhzvoPVX1vNOzOT27AAl4j5C/kUzEuzf6QHBIV5R/aq3a7vNIndX7zgK84ddQthN7Rmbm3bi1s3czEFQrpf+Yi7zXxUY56R+z80F1EnYcJ1e++QeQtBmtbMawpQcogKquJa7l+NB+0juQlUvOcsYEMuzAF/cZFQn5DvUgD6tLfA3CcwyUe86zHY3TOx32Aiq/BK/DxzWjjYfx+JOR8ehXEtI
      file: bubblesub.zip
      skip_cleanup: true
      on:
        repo: rr-/bubblesub
        branch: master
        tags: true
